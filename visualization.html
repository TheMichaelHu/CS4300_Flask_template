<!DOCTYPE html>
<html>
	
	<head>
		<title> Visualization </title>
		
			<link href="https://fonts.googleapis.com/css?family=Barlow+Condensed" rel="stylesheet">
			<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
			<script src="https://d3js.org/d3.v4.min.js"></script>
			<script src="http://d3js.org/topojson.v2.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		
				
			<style>
                
				body {  
                    font-size: 8;
                    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
                    }
                /* .hist { border: solid black 2px; } */
				
			</style>

			
	</head>
	
	<body>
        
        <div id = "viz">
        
        
        </div>
		
		<script>
            
				
            var tag = "#viz";
            var json = { 
                        "distribution_metadata": { 
                            "gender_dist": {
                                "by_movie": [["Male", 0.02], ["Female", 0.39], ["Dubious", 0.59]], 
                                "by_line": [["Male", 0.22], ["Female", 0.16], ["Dubious", 0.61]] 
                            }
                        }
                      };
            
            var jsonData = json["distribution_metadata"]["gender_dist"]["by_movie"];
            var jsonData2 = json["distribution_metadata"]["gender_dist"]["by_line"];
            
            var categories = ["By movie", "By line"];
            var categoryColors = ["#03353e", "#0294a5"];
            
            var svgWidth = 500;
            var svgHeight = 500;
            	
			var svg = d3.select(tag)
			.append("svg")
			.attr("width", svgWidth)
			.attr("height", svgHeight)
			.attr("class", "bar");
            
			var maxOffset = 0.9 * 400;
                        
			// scale
			var yScale = d3.scaleLinear()
			.domain([0, 1])
            // percentage between 0 and 1
			.range([0, maxOffset]);
            
            var yMax = d3.max(jsonData, function (d, i) { return d[1]; });
                        
            var pushX = 120;
            var pushY = 60;
            
            var interBarSpace = 60;
            var barWidth = 20;
				
			// data join
			var bars = svg.selectAll("rect")
			.data(jsonData)
			.enter();
            
			bars.append("rect")
			.attr("width", barWidth)
			.attr("height", function(d, i) { return yScale(jsonData[i][1]); })
			.attr("x", function (d, i) { return pushX + interBarSpace * i; })
			.attr("y", function (d, i) { return pushY + yScale(yMax) - yScale(jsonData[i][1]); })
			.attr("fill", categoryColors[0])
            .attr("data-legend",function(d) { return 1});
            
            bars
            .append("text")
            .text( function(d, i) { return jsonData2[i][0]; } )
            .attr("x", function(d, i) { return pushX + interBarSpace * i; })
            .attr("y", function(d, i) { return pushY - 5 + yScale(yMax) + 20; })
            .attr("fill", "black")
            .style("font-size", 14);
            
            var pushTextX = 120;
            var pushTextY = 180;
            
            var legendBarSize = 10;
            
            
            bars
            .append("text")
            .filter(function (d, i) { return i < categories.length } )
            .text( function(d, i) { console.log("Hi"); return categories[i]; } )
            .attr("x", function(d, i) { return pushTextX + interBarSpace * (jsonData.length + 1); })
            .attr("y", function(d, i) { return pushTextY + 20 * i; })
            .attr("fill", "black")
            .style("font-size", 14);
            
            bars
            .append("rect")
            .filter(function (d, i) { return i < categories.length } )
            .attr("width", legendBarSize)
			.attr("height", legendBarSize)
            .attr("x", function(d, i) { return pushTextX + interBarSpace * (jsonData.length + 1) - 15; })
            .attr("y", function(d, i) { return pushTextY + 20 * i - 10; })
            .attr("fill", function(d, i) {return categoryColors[i]; })
            .style("font-size", 14);
            
            
            // ---------------------------------------------------------------- //
            
            var yMax2 = d3.max(jsonData2, function (d, i) { return d[1]; });

            var pushX = 120 + barWidth;
            var pushY = 60;
            
			// data join
            bars
			.append("rect")
			.attr("width", barWidth)
			.attr("height", function(d, i) { return yScale(jsonData2[i][1]); })
			.attr("x", function (d, i) { return pushX + interBarSpace * i; })
			.attr("y", function (d, i) 
                  { return pushY + yScale(yMax) - yScale(jsonData2[i][1]); })
			.attr("fill", categoryColors[1]);            
	
		</script>
		
		<br> <br>

	</body>
	
</html>